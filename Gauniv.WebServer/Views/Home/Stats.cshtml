@model Gauniv.WebServer.Dtos.PlatformStatsDto
@{
    ViewData["Title"] = "Platform Statistics";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Platform Statistics</h1>
        <a asp-action="Shop" class="btn btn-primary">Browse Shop</a>
    </div>

    <!-- Main Stats Cards -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 mb-4">
        <div class="col">
            <div class="card h-100 text-center" style="background-color: rgba(0, 0, 0, 0.2);">
                <div class="card-body">
                    <h2 class="display-4 fw-bold" style="color: var(--steam-text-highlight);">@Model.TotalGamesAvailable</h2>
                    <p class="card-text text-muted">Total Games Available</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card h-100 text-center" style="background-color: rgba(0, 0, 0, 0.2);">
                <div class="card-body">
                    <h2 class="display-4 fw-bold" style="color: var(--steam-text-highlight);">@Model.AverageGamesPerAccount</h2>
                    <p class="card-text text-muted">Avg Games Per Account</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card h-100 text-center" style="background-color: rgba(0, 0, 0, 0.2);">
                <div class="card-body">
                    @{
                        var hours = Math.Floor(Model.AverageTimePlayedPerGameInMinutes / 60);
                        var minutes = Model.AverageTimePlayedPerGameInMinutes % 60;
                        var timeDisplay = hours > 0 ? $"{hours}h {minutes:F0}m" : $"{minutes:F0}m";
                    }
                    <h2 class="display-4 fw-bold" style="color: var(--steam-text-highlight);">@timeDisplay</h2>
                    <p class="card-text text-muted">Avg Time Played Per Game</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card h-100 text-center" style="background-color: rgba(0, 0, 0, 0.2);">
                <div class="card-body">
                    <h2 class="display-4 fw-bold" style="color: var(--steam-text-highlight);">
                        <span class="text-success">@Model.CurrentPlayersOnline</span>
                        <span class="fs-5 text-muted">/ @Model.MaxPlayersOnPlatform</span>
                    </h2>
                    <p class="card-text text-muted">Players Online (Current / Max)</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Games Per Category -->
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">Games Per Category</h5>
                </div>
                <div class="card-body p-0">
                    @if (!Model.GamesPerCategory.Any())
                    {
                        <div class="alert alert-info m-3">
                            No categories found.
                        </div>
                    }
                    else
                    {
                        <table class="table table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Category</th>
                                    <th scope="col" class="text-end">Games</th>
                                    <th scope="col" style="width: 40%"></th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var maxGames = Model.GamesPerCategory.Any() ? Model.GamesPerCategory.Max(c => c.GameCount) : 1;
                                }
                                @foreach (var category in Model.GamesPerCategory)
                                {
                                    var percentage = maxGames > 0 ? (category.GameCount * 100.0 / maxGames) : 0;
                                    <tr>
                                        <td>@category.CategoryTitle</td>
                                        <td class="text-end">
                                            <span class="badge bg-info">@category.GameCount</span>
                                        </td>
                                        <td>
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar bg-success" role="progressbar"
                                                     style="width: @percentage%;"
                                                     aria-valuenow="@category.GameCount"
                                                     aria-valuemin="0"
                                                     aria-valuemax="@maxGames">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>

        <!-- Max Players Per Game -->
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">Top Games by Max Simultaneous Players</h5>
                </div>
                <div class="card-body p-0">
                    @if (!Model.MaxPlayersPerGame.Any())
                    {
                        <div class="alert alert-info m-3">
                            No player data available yet.
                        </div>
                    }
                    else
                    {
                        <table class="table table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Game</th>
                                    <th scope="col" class="text-end">Max Players</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var rank = 1;
                                }
                                @foreach (var game in Model.MaxPlayersPerGame)
                                {
                                    <tr>
                                        <td>
                                            @if (rank == 1)
                                            {
                                                <span class="badge bg-warning text-dark">1st</span>
                                            }
                                            else if (rank == 2)
                                            {
                                                <span class="badge bg-secondary">2nd</span>
                                            }
                                            else if (rank == 3)
                                            {
                                                <span class="badge bg-danger">3rd</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">@rank</span>
                                            }
                                        </td>
                                        <td>
                                            <a asp-action="Details" asp-route-id="@game.GameId" class="text-decoration-none">
                                                @game.GameName
                                            </a>
                                        </td>
                                        <td class="text-end">
                                            <span class="badge bg-primary">@game.MaxPlayersConnectedSimultaneously</span>
                                        </td>
                                    </tr>
                                    rank++;
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
